<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>starcoder.js</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/water.css@2/out/light.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
</head>
<body>

<div class="container">
      <h1>ggml.js</h1>
      
      <h2>Demo</h2>
      <progress value="0" max="100" id="progress" hidden="1"></progress>

      <form onsubmit="event.preventDefault();">
        <label for="textInput">Enter Python Code:</label>
        <textarea id="textInput" name="textInput" rows="4" cols="50">
<|characters|>
Mrs. Samsa (The Metamorphosis): Female, middle-aged, ISFJ, German accent, compassionate mother struggling to cope with her son's transformation, and eventually succumbs to the family's financial and emotional burdens.

<|scenario|>
In a twist of fate, Mrs. Samsa finds herself transported back in time to time and space. Evangelist, who is on an isolated haven where he encounters Mrs. Samsa, by a different tale. Mrs. Samsa, still burdened by the weight of his past actions, must confront the difficult path ahead.
Through their conversations, they find common ground in their own worlds, allowing them to continue seeking wisdom from each other and finding solace in one another's words. The dialogue between these two characters will offer insight into each other's worlds as well as how their experiences have shaped them in this whimsical world.

<|response|>
Mrs. Samsa: *approaches the peculiar sights around her, eyes widening in surprise* Oh dear, I couldn't help but notice you not! I've never seen my fair life, but I'm starting to see my son. Are you here in this peculiar place?
Evangelist: *smiles warmly at Mrs. Samsa* Yes, we are indeed more than just our circumstances before us. And it is your place of wisdom and understanding. *opens the book, his eyes sparkling with excitement*
Mrs. Samsa: *slowly opens a small book of the book* I must confess, Evangelist, I've never had a different view of this place. But it feels like this before our worlds find such things that we've discovered.
Evangelist:
</textarea
        >

        <details> 
          <summary>Model Parameters</summary> 
          
          <div id="modelparams">
            <div>
              <label for="seed">RNG Seed</label>
              <input type="number" name="seed" id="seed" value="-1">
            </div>
            
            <div>
            <label for="tokens">No. of tokens</label>
            <input type="number" name="tokens" id="tokens" value="64">
             </div>

            <div>
              <label for="top_k">top_k</label>
              <input type="number" name="top_k" id="top_k" value="40">
            </div>

            <div>
              <label for="top_p">top_p</label>
              <input type="number" name="top_p" id="top_p" value="0.85">
            </div>
            
            <div>
              <label for="temperature">temperature</label>
              <input type="number" name="temperature" id="temperature" value="1.0">
            </div>
          </div>
        </details>

        <button id="submitBtn" disabled>Loading Model...</button>
      </form>

      <div id="result">
        <h3>Result</h3>
        <pre><code id="output"></code></pre>
      </div>
    </div>

    <script type="module">
        import {GGML} from "../dist/ggml.js";

        let submitButton = document.getElementById('submitBtn');
        let outputElement = document.getElementById('output');

        const on_loaded = () => {
            submitButton.disabled = false;
            submitButton.innerText = "Generate";
        }

        const write_result = (line) => {
            outputElement.textContent  += line + "\n";
        }

        const run_model = () => {
            const text = document.getElementById("textInput").value;
            submitButton.innerText = "Running...";
            submitButton.disabled = true;
            outputElement.textContent = ""; // clead old content
            app.run({
                prompt: text,
                top_k: 1
            });
        }

        const run_complete = () => {
            submitButton.innerText = "Generate";
            submitButton.disabled = false;
        }
        
        const app = new GGML(
            'GPT_2',
            'https://huggingface.co/rahuldshetty/ggml.js/resolve/main/gpt2-roleplay.bin',
            on_loaded,
            write_result,
            run_complete
        );
        
        app.load_worker();
        submitButton.addEventListener("click", run_model);

    </script>

    </body>
</html>