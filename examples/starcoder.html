<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>starcoder.js</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/water.css@2/out/light.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
</head>
<body>

<div class="container">
      <h1>ggml.js</h1>
      
      <h2>Demo</h2>
      <progress value="0" max="100" id="progress" hidden="1"></progress>

      <form onsubmit="event.preventDefault();">
        <label for="textInput">Enter Python Code:</label>
        <textarea id="textInput" name="textInput" rows="4" cols="50">
def fibonacci(</textarea
        >

        <details> 
          <summary>Model Parameters</summary> 
          
          <div id="modelparams">
            <div>
              <label for="seed">RNG Seed</label>
              <input type="number" name="seed" id="seed" value="-1">
            </div>
            
            <div>
            <label for="tokens">No. of tokens</label>
            <input type="number" name="tokens" id="tokens" value="64">
             </div>

            <div>
              <label for="top_k">top_k</label>
              <input type="number" name="top_k" id="top_k" value="40">
            </div>

            <div>
              <label for="top_p">top_p</label>
              <input type="number" name="top_p" id="top_p" value="0.85">
            </div>
            
            <div>
              <label for="temperature">temperature</label>
              <input type="number" name="temperature" id="temperature" value="1.0">
            </div>
          </div>
        </details>

        <button id="submitBtn" disabled>Loading Model...</button>
      </form>

      <div id="result">
        <h3>Result</h3>
        <pre><code id="output"></code></pre>
      </div>
    </div>

    <script type="module">
        import {GGML} from "../src/ggml.js";

        let submitButton = document.getElementById('submitBtn');
        let outputElement = document.getElementById('output');

        const on_loaded = () => {
            submitButton.disabled = false;
            submitButton.innerText = "Generate";
        }

        const write_result = (line) => {
            outputElement.textContent  += line + "\n";
        }

        const run_model = () => {
            const text = document.getElementById("textInput").value;
            submitButton.innerText = "Running...";
            submitButton.disabled = true;
            outputElement.textContent = ""; // clead old content
            app.run({
                prompt: text,
                top_k: 1
            });
        }

        const run_complete = () => {
            submitButton.innerText = "Generate";
            submitButton.disabled = false;
        }
        
        const app = new GGML(
            'STARCODER',
            '../../models/starcoder.bin',
            on_loaded,
            write_result,
            run_complete
        );
        
        app.load_worker();
        submitButton.addEventListener("click", run_model);

    </script>

    </body>
</html>